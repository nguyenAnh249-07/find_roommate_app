<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S∆° ƒê·ªì Lu·ªìng ·ª®ng D·ª•ng Find Roommate App</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        h2 {
            color: #667eea;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 1.8em;
        }
        
        h3 {
            color: #764ba2;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .diagram-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .mermaid {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .summary h3 {
            color: white;
            margin-top: 0;
        }
        
        .summary ul {
            list-style: none;
            padding-left: 0;
        }
        
        .summary li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .summary li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .note strong {
            color: #856404;
        }
        
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä S∆° ƒê·ªì Lu·ªìng ·ª®ng D·ª•ng Find Roommate App</h1>
        
        <div class="summary">
            <h3>üéØ T·ªïng Quan</h3>
            <p>·ª®ng d·ª•ng t√¨m ph√≤ng tr·ªç v√† b·∫°n ·ªü gh√©p v·ªõi 3 vai tr√≤ ch√≠nh: User, Owner, v√† Admin. T·∫•t c·∫£ c√°c lu·ªìng ƒë∆∞·ª£c qu·∫£n l√Ω qua Firebase Firestore v·ªõi real-time updates.</p>
        </div>

        <h2>1. S∆° ƒê·ªì T·ªïng Qu√°t</h2>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    Start([Kh·ªüi ƒë·ªông App]) --> Init[Kh·ªüi t·∫°o Firebase]
    Init --> CheckAuth{ƒê√£ ƒëƒÉng nh·∫≠p?}
    
    CheckAuth -->|Ch∆∞a| LoginScreen[M√†n h√¨nh ƒêƒÉng nh·∫≠p]
    CheckAuth -->|R·ªìi| LoadUser[Load th√¥ng tin User]
    
    LoginScreen --> Register[ƒêƒÉng k√Ω]
    LoginScreen --> ForgotPass[Qu√™n m·∫≠t kh·∫©u]
    LoginScreen --> Login[ƒêƒÉng nh·∫≠p]
    
    Register --> OTPVerify[X√°c th·ª±c OTP Email]
    OTPVerify -->|Th√†nh c√¥ng| SaveUser[L∆∞u User v√†o Firestore]
    OTPVerify -->|Th·∫•t b·∫°i| Register
    
    ForgotPass --> OTPVerify2[G·ª≠i OTP Reset]
    OTPVerify2 --> ResetPass[ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u]
    ResetPass --> LoginScreen
    
    Login --> LoadUser
    SaveUser --> LoadUser
    
    LoadUser --> CheckRole{Ph√¢n quy·ªÅn User}
    
    CheckRole -->|user| UserHome[Home Screen - User]
    CheckRole -->|owner| OwnerDashboard[Owner Dashboard]
    CheckRole -->|admin| AdminDashboard[Admin Dashboard]
    
    %% User Flow
    UserHome --> BrowseRooms[T√¨m ki·∫øm/L·ªçc ph√≤ng]
    BrowseRooms --> RoomDetail[Chi ti·∫øt ph√≤ng]
    RoomDetail --> Chat[Chat v·ªõi ch·ªß tr·ªç]
    RoomDetail --> SendRequest[G·ª≠i y√™u c·∫ßu]
    RoomDetail --> SaveRoom[L∆∞u ph√≤ng y√™u th√≠ch]
    
    SendRequest --> RoommateReq[Y√™u c·∫ßu ·ªü gh√©p]
    SendRequest --> RentalReq[Y√™u c·∫ßu thu√™ ph√≤ng]
    
    UserHome --> MyRequests[Y√™u c·∫ßu c·ªßa t√¥i]
    UserHome --> SavedRooms[Ph√≤ng ƒë√£ l∆∞u]
    UserHome --> TenantDashboard[Tenant Dashboard]
    UserHome --> Profile[H·ªì s∆° c√° nh√¢n]
    UserHome --> Support[H·ªó tr·ª£]
    
    TenantDashboard --> ViewContracts[Xem h·ª£p ƒë·ªìng]
    TenantDashboard --> ViewPayments[Xem thanh to√°n]
    
    %% Owner Flow
    OwnerDashboard --> CreateRoom[T·∫°o ph√≤ng m·ªõi]
    OwnerDashboard --> MyRooms[Ph√≤ng c·ªßa t√¥i]
    OwnerDashboard --> ManageRoommateReq[Qu·∫£n l√Ω y√™u c·∫ßu ·ªü gh√©p]
    OwnerDashboard --> ManageRentalReq[Qu·∫£n l√Ω y√™u c·∫ßu thu√™]
    OwnerDashboard --> ViewOccupants[Xem ng∆∞·ªùi ·ªü]
    OwnerDashboard --> Contracts[Qu·∫£n l√Ω h·ª£p ƒë·ªìng]
    OwnerDashboard --> Payments[Qu·∫£n l√Ω thanh to√°n]
    OwnerDashboard --> Statistics[Th·ªëng k√™ doanh thu]
    
    CreateRoom --> CreatePost[T·∫°o b√†i ƒëƒÉng]
    CreatePost --> WaitApproval[Ch·ªù Admin duy·ªát]
    
    MyRooms --> EditRoom[S·ª≠a ph√≤ng]
    MyRooms --> HideRoom[·∫®n ph√≤ng]
    MyRooms --> DeleteRoom[X√≥a ph√≤ng]
    
    ManageRoommateReq --> ApproveRoommate[Duy·ªát/T·ª´ ch·ªëi ·ªü gh√©p]
    ManageRentalReq --> ApproveRental[Duy·ªát/T·ª´ ch·ªëi thu√™]
    
    ApproveRoommate --> CreateContract
    ApproveRental --> CreateContract[T·∫°o h·ª£p ƒë·ªìng]
    CreateContract --> CreatePayment[T·∫°o h√≥a ƒë∆°n]
    
    %% Admin Flow
    AdminDashboard --> PendingPosts[B√†i ƒëƒÉng ch·ªù duy·ªát]
    AdminDashboard --> UserManagement[Qu·∫£n l√Ω ng∆∞·ªùi d√πng]
    AdminDashboard --> CategoryManagement[Qu·∫£n l√Ω danh m·ª•c]
    AdminDashboard --> AdminStatistics[Th·ªëng k√™ h·ªá th·ªëng]
    AdminDashboard --> OwnerRequests[Y√™u c·∫ßu tr·ªü th√†nh Owner]
    
    PendingPosts --> ApprovePost[Duy·ªát b√†i ƒëƒÉng]
    PendingPosts --> RejectPost[T·ª´ ch·ªëi b√†i ƒëƒÉng]
    
    UserManagement --> ChangeRole[ƒê·ªïi vai tr√≤]
    UserManagement --> BanUser[Kh√≥a t√†i kho·∫£n]
    
    CategoryManagement --> AddCategory[Th√™m danh m·ª•c]
    CategoryManagement --> DeleteCategory[X√≥a danh m·ª•c]
    
    OwnerRequests --> ApproveOwner[Duy·ªát y√™u c·∫ßu Owner]
    OwnerRequests --> RejectOwner[T·ª´ ch·ªëi y√™u c·∫ßu]
    
    %% Logout
    UserHome --> Logout[ƒêƒÉng xu·∫•t]
    OwnerDashboard --> Logout
    AdminDashboard --> Logout
    Logout --> LoginScreen
    
    style Start fill:#e1f5ff
    style LoginScreen fill:#fff4e6
    style UserHome fill:#e8f5e9
    style OwnerDashboard fill:#fff3e0
    style AdminDashboard fill:#f3e5f5
    style Logout fill:#ffebee
            </div>
        </div>

        <h2>2. Lu·ªìng X√°c Th·ª±c Chi Ti·∫øt</h2>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant U as User
    participant App as ·ª®ng d·ª•ng
    participant Auth as Firebase Auth
    participant OTP as OTP Service
    participant Firestore as Cloud Firestore
    
    Note over U,Firestore: ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi
    U->>App: Nh·∫≠p email, password, th√¥ng tin
    App->>Auth: createUserWithEmailAndPassword()
    Auth-->>App: UserCredential
    App->>OTP: G·ª≠i OTP qua Email SMTP
    OTP-->>U: Email ch·ª©a m√£ OTP
    U->>App: Nh·∫≠p m√£ OTP
    App->>OTP: X√°c th·ª±c OTP
    OTP-->>App: X√°c th·ª±c th√†nh c√¥ng
    App->>Firestore: L∆∞u UserModel (role: 'user')
    Firestore-->>App: L∆∞u th√†nh c√¥ng
    App-->>U: Chuy·ªÉn ƒë·∫øn Home Screen
    
    Note over U,Firestore: ƒêƒÉng nh·∫≠p
    U->>App: Nh·∫≠p email, password
    App->>Auth: signInWithEmailAndPassword()
    Auth-->>App: UserCredential
    App->>Firestore: L·∫•y UserModel theo userId
    Firestore-->>App: UserModel v·ªõi role
    App->>App: Route theo role (user/owner/admin)
    App-->>U: Hi·ªÉn th·ªã Dashboard t∆∞∆°ng ·ª©ng
    
    Note over U,Firestore: Qu√™n m·∫≠t kh·∫©u
    U->>App: Nh·∫≠p email
    App->>OTP: G·ª≠i OTP Reset Password
    OTP-->>U: Email ch·ª©a m√£ OTP
    U->>App: Nh·∫≠p m√£ OTP
    App->>OTP: X√°c th·ª±c OTP
    OTP-->>App: X√°c th·ª±c th√†nh c√¥ng
    App->>U: Cho ph√©p ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u
    U->>App: Nh·∫≠p m·∫≠t kh·∫©u m·ªõi
    App->>Auth: updatePassword()
    Auth-->>App: C·∫≠p nh·∫≠t th√†nh c√¥ng
    App-->>U: Chuy·ªÉn ƒë·∫øn Login Screen
            </div>
        </div>

        <h2>3. Lu·ªìng Ng∆∞·ªùi D√πng (User)</h2>
        <div class="diagram-container">
            <div class="mermaid">
graph LR
    A[Home Screen] --> B[T√¨m ki·∫øm/L·ªçc ph√≤ng]
    A --> C[Ph√≤ng ƒë√£ l∆∞u]
    A --> D[Y√™u c·∫ßu c·ªßa t√¥i]
    A --> E[Tenant Dashboard]
    A --> F[H·ªì s∆°]
    A --> G[H·ªó tr·ª£]
    
    B --> H[Chi ti·∫øt ph√≤ng]
    H --> I[Chat v·ªõi ch·ªß tr·ªç]
    H --> J[G·ª≠i y√™u c·∫ßu ·ªü gh√©p]
    H --> K[G·ª≠i y√™u c·∫ßu thu√™]
    H --> L[L∆∞u ph√≤ng]
    
    J --> M[Ch·ªù Owner duy·ªát]
    K --> M
    
    M -->|ƒê∆∞·ª£c duy·ªát| N[Owner t·∫°o h·ª£p ƒë·ªìng]
    N --> O[Tenant xem h·ª£p ƒë·ªìng]
    O --> P[Owner t·∫°o h√≥a ƒë∆°n]
    P --> Q[Tenant xem thanh to√°n]
    
    E --> O
    E --> Q
    
    style A fill:#e8f5e9
    style H fill:#c8e6c9
    style N fill:#a5d6a7
            </div>
        </div>

        <h2>4. Lu·ªìng Ch·ªß Tr·ªç (Owner)</h2>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    A[Owner Dashboard] --> B[T·∫°o ph√≤ng m·ªõi]
    A --> C[Ph√≤ng c·ªßa t√¥i]
    A --> D[Y√™u c·∫ßu ·ªü gh√©p]
    A --> E[Y√™u c·∫ßu thu√™]
    A --> F[Ng∆∞·ªùi ƒëang ·ªü]
    A --> G[H·ª£p ƒë·ªìng]
    A --> H[Thanh to√°n]
    A --> I[Th·ªëng k√™]
    
    B --> J[ƒêi·ªÅn th√¥ng tin ph√≤ng]
    J --> K[T·∫°o b√†i ƒëƒÉng]
    K --> L[Ch·ªù Admin duy·ªát]
    L -->|ƒê∆∞·ª£c duy·ªát| M[B√†i ƒëƒÉng hi·ªÉn th·ªã]
    L -->|B·ªã t·ª´ ch·ªëi| N[Ch·ªânh s·ª≠a l·∫°i]
    N --> K
    
    C --> O[S·ª≠a ph√≤ng]
    C --> P[·∫®n ph√≤ng]
    C --> Q[X√≥a ph√≤ng]
    
    D --> R[Duy·ªát/T·ª´ ch·ªëi y√™u c·∫ßu]
    E --> S[Duy·ªát/T·ª´ ch·ªëi y√™u c·∫ßu]
    
    R -->|ƒê·ªìng √Ω| T[T·∫°o h·ª£p ƒë·ªìng]
    S -->|ƒê·ªìng √Ω| T
    
    T --> U[T·∫°o h√≥a ƒë∆°n]
    U --> V[Qu·∫£n l√Ω thanh to√°n]
    
    F --> W[Xem danh s√°ch ng∆∞·ªùi ·ªü]
    W --> X[Xem h·ªì s∆° ng∆∞·ªùi thu√™]
    
    I --> Y[Doanh thu]
    I --> Z[S·ªë ph√≤ng]
    I --> AA[S·ªë h·ª£p ƒë·ªìng]
    
    style A fill:#fff3e0
    style T fill:#ffe0b2
    style I fill:#ffcc80
            </div>
        </div>

        <h2>5. Lu·ªìng Qu·∫£n Tr·ªã Vi√™n (Admin)</h2>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    A[Admin Dashboard] --> B[B√†i ƒëƒÉng ch·ªù duy·ªát]
    A --> C[Qu·∫£n l√Ω ng∆∞·ªùi d√πng]
    A --> D[Qu·∫£n l√Ω danh m·ª•c]
    A --> E[Th·ªëng k√™ h·ªá th·ªëng]
    A --> F[Y√™u c·∫ßu tr·ªü th√†nh Owner]
    
    B --> G[Duy·ªát b√†i ƒëƒÉng]
    B --> H[T·ª´ ch·ªëi b√†i ƒëƒÉng]
    G --> I[B√†i ƒëƒÉng hi·ªÉn th·ªã]
    H --> J[G·ª≠i th√¥ng b√°o t·ª´ ch·ªëi]
    
    C --> K[Xem danh s√°ch users]
    K --> L[ƒê·ªïi vai tr√≤]
    K --> M[Kh√≥a/K√≠ch ho·∫°t t√†i kho·∫£n]
    K --> N[Xem h·ªì s∆°]
    
    D --> O[Qu·∫£n l√Ω lo·∫°i ph√≤ng]
    D --> P[Qu·∫£n l√Ω khu v·ª±c]
    O --> Q[Th√™m/X√≥a lo·∫°i ph√≤ng]
    P --> R[Th√™m/X√≥a khu v·ª±c]
    
    E --> S[Th·ªëng k√™ users]
    E --> T[Th·ªëng k√™ ph√≤ng]
    E --> U[Th·ªëng k√™ b√†i ƒëƒÉng]
    E --> V[Th·ªëng k√™ h·ª£p ƒë·ªìng & thanh to√°n]
    
    F --> W[Duy·ªát y√™u c·∫ßu Owner]
    F --> X[T·ª´ ch·ªëi y√™u c·∫ßu Owner]
    W --> Y[C·∫≠p nh·∫≠t role: owner]
    
    style A fill:#f3e5f5
    style G fill:#e1bee7
    style E fill:#ce93d8
            </div>
        </div>

        <h2>6. Lu·ªìng Chat Real-time</h2>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant U as User
    participant App as ·ª®ng d·ª•ng
    participant Firestore as Cloud Firestore
    participant O as Owner
    
    U->>App: Xem chi ti·∫øt ph√≤ng
    App->>App: Hi·ªÉn th·ªã n√∫t "Chat v·ªõi ch·ªß tr·ªç"
    U->>App: Nh·∫•n n√∫t Chat
    App->>Firestore: L·∫•y ownerId t·ª´ Room
    Firestore-->>App: ownerId
    App->>App: M·ªü Chat Screen v·ªõi ownerId
    
    Note over U,O: Real-time Chat
    U->>App: Nh·∫≠p tin nh·∫Øn
    App->>Firestore: L∆∞u MessageModel
    Firestore-->>O: Real-time update (Stream)
    O->>App: Xem tin nh·∫Øn
    O->>App: Tr·∫£ l·ªùi
    App->>Firestore: L∆∞u MessageModel
    Firestore-->>U: Real-time update (Stream)
    U->>App: Xem tin nh·∫Øn m·ªõi
    
    Note over U,O: ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc
    U->>App: M·ªü cu·ªôc tr√≤ chuy·ªán
    App->>Firestore: markMessageAsRead()
    Firestore-->>App: C·∫≠p nh·∫≠t isRead = true
            </div>
        </div>

        <h2>7. Lu·ªìng Y√™u C·∫ßu v√† H·ª£p ƒê·ªìng</h2>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    A[User xem ph√≤ng] --> B[G·ª≠i y√™u c·∫ßu]
    B --> C{Y√™u c·∫ßu g√¨?}
    
    C -->|·ªû gh√©p| D[Roommate Request]
    C -->|Thu√™ ph√≤ng| E[Rental Request]
    
    D --> F[Owner xem y√™u c·∫ßu]
    E --> F
    
    F --> G{Quy·∫øt ƒë·ªãnh}
    G -->|ƒê·ªìng √Ω| H[T·∫°o h·ª£p ƒë·ªìng]
    G -->|T·ª´ ch·ªëi| I[Y√™u c·∫ßu b·ªã t·ª´ ch·ªëi]
    
    H --> J[ContractModel]
    J --> K[Tenant xem h·ª£p ƒë·ªìng]
    
    H --> L[T·∫°o h√≥a ƒë∆°n]
    L --> M[PaymentModel]
    M --> N[Tenant xem thanh to√°n]
    
    N --> O{Thanh to√°n}
    O -->|ƒê√£ thanh to√°n| P[Owner c·∫≠p nh·∫≠t tr·∫°ng th√°i]
    O -->|Ch∆∞a| Q[Ch·ªù thanh to√°n]
    
    style H fill:#a5d6a7
    style L fill:#c8e6c9
    style P fill:#81c784
            </div>
        </div>

        <h2>8. C·∫•u Tr√∫c Database (Firestore)</h2>
        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    USERS ||--o{ ROOMS : "owns"
    USERS ||--o{ POSTS : "creates"
    USERS ||--o{ ROOMMATE_REQUESTS : "sends"
    USERS ||--o{ RENTAL_REQUESTS : "sends"
    USERS ||--o{ CONTRACTS : "has"
    USERS ||--o{ PAYMENTS : "pays"
    USERS ||--o{ MESSAGES : "sends/receives"
    
    ROOMS ||--o| POSTS : "has"
    ROOMS ||--o{ ROOMMATE_REQUESTS : "receives"
    ROOMS ||--o{ RENTAL_REQUESTS : "receives"
    ROOMS ||--o{ CONTRACTS : "has"
    
    CONTRACTS ||--o{ PAYMENTS : "has"
    
    USERS {
        string id PK
        string email
        string fullName
        string role
        string status
        array savedRooms
    }
    
    ROOMS {
        string id PK
        string ownerId FK
        string title
        string description
        double price
        double area
        string status
    }
    
    POSTS {
        string id PK
        string roomId FK
        string ownerId FK
        string status
        string adminNote
    }
    
    ROOMMATE_REQUESTS {
        string id PK
        string userId FK
        string ownerId FK
        string roomId FK
        string status
    }
    
    RENTAL_REQUESTS {
        string id PK
        string userId FK
        string ownerId FK
        string roomId FK
        string status
    }
    
    CONTRACTS {
        string id PK
        string ownerId FK
        array tenantIds FK
        string roomId FK
        datetime startDate
        datetime endDate
    }
    
    PAYMENTS {
        string id PK
        string ownerId FK
        string tenantId FK
        string contractId FK
        double amount
        string status
    }
    
    MESSAGES {
        string id PK
        string senderId FK
        string receiverId FK
        string content
        bool isRead
    }
            </div>
        </div>

        <div class="note">
            <strong>üìù Ghi ch√∫:</strong>
            <ul style="margin-top: 10px; padding-left: 20px;">
                <li>T·∫•t c·∫£ c√°c lu·ªìng ƒë·ªÅu s·ª≠ d·ª•ng <strong>Firebase Firestore</strong> l√†m database</li>
                <li><strong>Real-time updates</strong> ƒë∆∞·ª£c th·ª±c hi·ªán qua StreamBuilder</li>
                <li><strong>State management</strong> s·ª≠ d·ª•ng <strong>Riverpod</strong></li>
                <li><strong>UI/UX</strong> ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi <strong>Material 3</strong></li>
                <li>X√°c th·ª±c s·ª≠ d·ª•ng <strong>Firebase Auth</strong> v√† <strong>OTP qua Email SMTP</strong></li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#764ba2',
                lineColor: '#667eea',
                secondaryColor: '#f3e5f5',
                tertiaryColor: '#e8f5e9'
            }
        });
    </script>
</body>
</html>

